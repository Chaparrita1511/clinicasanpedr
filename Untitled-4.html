<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Clínica San Pedro - Sistema de Citas e Ingresos</title>
  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --accent:#0b6cff; --muted:#6b7280; --success:#16a34a; --danger:#dc2626;
      --shadow: 0 6px 18px rgba(12,34,63,0.08);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#f8fafc, #eef2ff);color:#0f172a}
    header{background:var(--card);border-bottom:1px solid #e6eefc;padding:18px 28px;display:flex;align-items:center;justify-content:space-between;box-shadow:var(--shadow)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    h1{font-size:18px;margin:0}
    nav a{margin-left:12px;text-decoration:none;color:var(--muted)}
    main{display:grid;grid-template-columns:300px 1fr;gap:18px;padding:20px}
    aside{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow)}
    .menu{display:flex;flex-direction:column;gap:8px}
    .menu button{background:transparent;border:0;padding:10px;border-radius:8px;text-align:left;cursor:pointer;color:#0f172a}
    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow)}
    form{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    label{font-size:13px;color:var(--muted)}
    input,select,textarea{padding:10px;border:1px solid #e6eefc;border-radius:8px;font-size:14px}
    .full{grid-column:1/-1}
    .actions{display:flex;gap:8px;justify-content:flex-end}
    button.primary{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
    button.ghost{background:transparent;border:1px solid #e6eefc;padding:10px 12px;border-radius:8px;cursor:pointer}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #f1f5f9;text-align:left;font-size:14px}
    .muted{color:var(--muted);font-size:13px}
    .small{font-size:12px}
    .row-actions button{margin-right:6px}
    .notice{background:#fffbe6;padding:10px;border-radius:8px;border:1px solid #fff2cc;color:#665200}
    footer{padding:14px 22px;text-align:center;color:var(--muted)}
    @media(max-width:900px){main{grid-template-columns:1fr} aside{order:2}}
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo">SP</div>
      <div>
        <h1>Clínica San Pedro</h1>
        <div class="muted small">Sistema de Ingresos y Citas</div>
      </div>
    </div>
    <nav>
      <a href="#inicio">Inicio</a>
      <a href="#pacientes">Pacientes</a>
      <a href="#medicos">Médicos</a>
      <a href="#ingresos">Ingresos</a>
      <a href="#citas">Agenda</a>
    </nav>
  </header>

  <main>
    <aside class="card">
      <h3>Secciones</h3>
      <div class="menu">
        <button onclick="showSection('inicio')">Inicio</button>
        <button onclick="showSection('pacientes')">Datos del paciente</button>
        <button onclick="showSection('registro-paciente')">Registro de paciente</button>
        <button onclick="showSection('medicos')">Datos del médico</button>
        <button onclick="showSection('registro-medico')">Registro de médicos</button>
        <button onclick="showSection('ingresos')">Agenda de ingreso</button>
        <button onclick="showSection('citas')">Agenda de citas</button>
      </div>
      <hr style="margin:12px 0">
      <div class="muted small">Nota:</div>
      <div class="muted small">- Cada ingreso genera un <strong>código de ingreso único</strong>.<br>- Un médico puede atender varios ingresos.<br>- Todos los ingresos de un paciente deben pertenecer al <strong>mismo médico</strong>.<br>- Las citas se programan <strong>después</strong> de la fecha de alta (estancia).</div>
    </aside>

    <section>
      <!-- Inicio -->
      <div id="inicio" class="card section">
        <h2>Inicio</h2>
        <p class="muted">Panel de control rápido — información resumida de la clínica.</p>
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px">
          <div class="card">
            <div class="muted small">Pacientes registrados</div>
            <div id="count-pacientes" style="font-size:20px;font-weight:700">0</div>
          </div>
          <div class="card">
            <div class="muted small">Médicos registrados</div>
            <div id="count-medicos" style="font-size:20px;font-weight:700">0</div>
          </div>
          <div class="card">
            <div class="muted small">Ingresos</div>
            <div id="count-ingresos" style="font-size:20px;font-weight:700">0</div>
          </div>
        </div>
      </div>

      <!-- Datos del paciente -->
      <div id="pacientes" class="card section" style="margin-top:12px;display:none">
        <h2>Datos del paciente</h2>
        <p class="muted">Lista y edición de pacientes.</p>
        <div style="margin-top:10px">
          <table id="table-pacientes">
            <thead><tr><th>Nombre</th><th>Teléfono</th><th>CP</th><th>Fecha Nac.</th><th>Acciones</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Registro paciente -->
      <div id="registro-paciente" class="card section" style="margin-top:12px;display:none">
        <h2>Registro de paciente</h2>
        <form id="form-paciente">
          <label>Nombre<input required name="nombre"></label>
          <label>Apellido<input required name="apellido"></label>
          <label>Dirección<input name="direccion"></label>
          <label>Teléfono<input name="telefono"></label>
          <label>Código Postal<input name="cp"></label>
          <label>Fecha de Nacimiento<input type="date" name="fechaNacimiento"></label>
          <div class="full actions">
            <button type="button" class="ghost" onclick="resetPacienteForm()">Limpiar</button>
            <button class="primary" type="submit">Guardar paciente</button>
          </div>
        </form>
      </div>

      <!-- Medicos -->
      <div id="medicos" class="card section" style="margin-top:12px;display:none">
        <h2>Datos del médico</h2>
        <p class="muted">Lista de médicos y sus especialidades.</p>
        <div style="margin-top:10px">
          <table id="table-medicos">
            <thead><tr><th>Nombre</th><th>Tel</th><th>Especialidad</th><th>CP</th><th>Acciones</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- Registro medico -->
      <div id="registro-medico" class="card section" style="margin-top:12px;display:none">
        <h2>Registro de médicos</h2>
        <form id="form-medico">
          <label>Nombre<input required name="nombre"></label>
          <label>Apellido<input required name="apellido"></label>
          <label>Dirección<input name="direccion"></label>
          <label>Teléfono<input name="telefono"></label>
          <label>Especialidad<input name="especialidad"></label>
          <label>Código Postal<input name="cp"></label>
          <div class="full actions">
            <button type="button" class="ghost" onclick="resetMedicoForm()">Limpiar</button>
            <button class="primary" type="submit">Guardar médico</button>
          </div>
        </form>
      </div>

      <!-- Ingresos -->
      <div id="ingresos" class="card section" style="margin-top:12px;display:none">
        <h2>Registro de ingreso / estancias</h2>
        <p class="muted">Cada ingreso produce un <strong>código único</strong> y registra habitación, cama y las fechas de ingreso/alta.</p>
        <form id="form-ingreso" style="margin-top:10px">
          <label class="full">Paciente<select required name="pacienteId" id="select-pacientes-for-ingreso"></select></label>
          <label>Médico<select required name="medicoId" id="select-medicos-for-ingreso"></select></label>
          <label>Fecha de ingreso<input type="date" name="fechaIngreso"></label>
          <label>Fecha de alta<input type="date" name="fechaAlta"></label>
          <label>Número de habitación<input name="habitacion"></label>
          <label>Número de cama<input name="cama"></label>
          <div class="full actions">
            <button type="button" class="ghost" onclick="resetIngresoForm()">Limpiar</button>
            <button class="primary" type="submit">Guardar ingreso</button>
          </div>
        </form>

        <hr style="margin:12px 0">
        <h3>Ingresos registrados</h3>
        <table id="table-ingresos">
          <thead><tr><th>Código</th><th>Paciente</th><th>Médico</th><th>Hab/Cama</th><th>Ingreso</th><th>Alta</th><th>Acciones</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- Citas -->
      <div id="citas" class="card section" style="margin-top:12px;display:none">
        <h2>Agenda de citas</h2>
        <p class="muted">Las citas sólo pueden programarse después de la fecha de alta del ingreso del paciente.</p>
        <form id="form-cita" style="margin-top:10px">
          <label class="full">Paciente<select required name="pacienteId" id="select-pacientes-for-cita"></select></label>
          <label class="full">Médico<select required name="medicoId" id="select-medicos-for-cita"></select></label>
          <label>Fecha de cita<input type="datetime-local" name="fechaCita"></label>
          <label class="full">Descripción<textarea name="descripcion" rows="3"></textarea></label>
          <div class="full actions">
            <button type="button" class="ghost" onclick="resetCitaForm()">Limpiar</button>
            <button class="primary" type="submit">Agendar cita</button>
          </div>
        </form>

        <hr style="margin:12px 0">
        <h3>Citas programadas</h3>
        <table id="table-citas">
          <thead><tr><th>Paciente</th><th>Médico</th><th>Fecha</th><th>Descripción</th><th>Acciones</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>

    </section>
  </main>

  <footer>
    © Clínica San Pedro — Sistema demo. Desarrollo: ChatGPT (como programador web)
  </footer>

<script>
// --- Utilidades de almacenamiento (simula DB con localStorage) ---
const DB = {
  pacientesKey: 'clinica_pacientes_v1',
  medicosKey: 'clinica_medicos_v1',
  ingresosKey: 'clinica_ingresos_v1',
  citasKey: 'clinica_citas_v1',
  load(key){ return JSON.parse(localStorage.getItem(key) || '[]') },
  save(key, data){ localStorage.setItem(key, JSON.stringify(data)) }
}

// --- Estado y helpers ---
function uid(prefix='id'){ return prefix + '_' + Date.now().toString(36) + Math.random().toString(36).slice(2,7) }
function genCodigoIngreso(){ return 'ING-' + new Date().toISOString().slice(0,10).replace(/-/g,'') + '-' + Math.floor(Math.random()*9000+1000) }

// --- Mostrar secciones ---
function showSection(id){ document.querySelectorAll('.section').forEach(s=>s.style.display='none'); const el=document.getElementById(id); if(el) el.style.display='block'; if(id==='pacientes'||id==='registro-paciente') renderPacientes(); if(id==='medicos'||id==='registro-medico') renderMedicos(); if(id==='ingresos') renderIngresos(); if(id==='citas') renderCitas(); updateCounters(); populateSelects(); }
showSection('inicio')

// --- Pacientes CRUD ---
const formPaciente = document.getElementById('form-paciente');
let editPacienteId = null;
formPaciente.addEventListener('submit', e=>{
  e.preventDefault(); const f=new FormData(formPaciente);
  const p = { id: editPacienteId||uid('pac'), nombre:f.get('nombre'), apellido:f.get('apellido'), direccion:f.get('direccion'), telefono:f.get('telefono'), cp:f.get('cp'), fechaNacimiento:f.get('fechaNacimiento') }
  const pacientes = DB.load(DB.pacientesKey);
  if(editPacienteId){ const idx=pacientes.findIndex(x=>x.id===editPacienteId); pacientes[idx]=p; editPacienteId=null; }
  else pacientes.push(p);
  DB.save(DB.pacientesKey,pacientes); formPaciente.reset(); renderPacientes(); populateSelects(); updateCounters(); alert('Paciente guardado.');
})

function renderPacientes(){ const tbody=document.querySelector('#table-pacientes tbody'); tbody.innerHTML=''; const pacientes=DB.load(DB.pacientesKey);
  pacientes.forEach(p=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${p.nombre} ${p.apellido}</td><td>${p.telefono||''}</td><td>${p.cp||''}</td><td>${p.fechaNacimiento||''}</td><td class="row-actions"><button onclick="editPaciente('${p.id}')">Editar</button><button onclick="eliminarPaciente('${p.id}')">Eliminar</button></td>`; tbody.appendChild(tr); }) }

function editPaciente(id){ const pacientes=DB.load(DB.pacientesKey); const p=pacientes.find(x=>x.id===id); if(!p) return; editPacienteId=id; formPaciente.nombre.value=p.nombre; formPaciente.apellido.value=p.apellido; formPaciente.direccion.value=p.direccion; formPaciente.telefono.value=p.telefono; formPaciente.cp.value=p.cp; formPaciente.fechaNacimiento.value=p.fechaNacimiento; showSection('registro-paciente'); }
function eliminarPaciente(id){ if(!confirm('Eliminar paciente?')) return; // Also cascade delete: remove ingresos and citas of that paciente
  let pacientes=DB.load(DB.pacientesKey); pacientes=pacientes.filter(x=>x.id!==id); DB.save(DB.pacientesKey,pacientes);
  let ingresos=DB.load(DB.ingresosKey); ingresos=ingresos.filter(i=>i.pacienteId!==id); DB.save(DB.ingresosKey,ingresos);
  let citas=DB.load(DB.citasKey); citas=citas.filter(c=>c.pacienteId!==id); DB.save(DB.citasKey,citas);
  renderPacientes(); renderIngresos(); renderCitas(); populateSelects(); updateCounters(); }
function resetPacienteForm(){ editPacienteId=null; formPaciente.reset(); }

// --- Medicos CRUD ---
const formMedico=document.getElementById('form-medico'); let editMedicoId=null;
formMedico.addEventListener('submit', e=>{ e.preventDefault(); const f=new FormData(formMedico); const m={ id: editMedicoId||uid('med'), nombre:f.get('nombre'), apellido:f.get('apellido'), direccion:f.get('direccion'), telefono:f.get('telefono'), especialidad:f.get('especialidad'), cp:f.get('cp') }
  const medicos=DB.load(DB.medicosKey);
  if(editMedicoId){ const idx=medicos.findIndex(x=>x.id===editMedicoId); medicos[idx]=m; editMedicoId=null;} else medicos.push(m);
  DB.save(DB.medicosKey,medicos); formMedico.reset(); renderMedicos(); populateSelects(); updateCounters(); alert('Médico guardado.'); })

function renderMedicos(){ const tbody=document.querySelector('#table-medicos tbody'); tbody.innerHTML=''; const medicos=DB.load(DB.medicosKey);
  medicos.forEach(m=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td>${m.nombre} ${m.apellido}</td><td>${m.telefono||''}</td><td>${m.especialidad||''}</td><td>${m.cp||''}</td><td class="row-actions"><button onclick="editMedico('${m.id}')">Editar</button><button onclick="eliminarMedico('${m.id}')">Eliminar</button></td>`; tbody.appendChild(tr); }) }

function editMedico(id){ const medicos=DB.load(DB.medicosKey); const m=medicos.find(x=>x.id===id); if(!m) return; editMedicoId=id; formMedico.nombre.value=m.nombre; formMedico.apellido.value=m.apellido; formMedico.direccion.value=m.direccion; formMedico.telefono.value=m.telefono; formMedico.especialidad.value=m.especialidad; formMedico.cp.value=m.cp; showSection('registro-medico'); }
function eliminarMedico(id){ if(!confirm('Eliminar médico? Esto no eliminará ingresos ya asignados, pero éstos quedarán con referencia huérfana.')) return; let medicos=DB.load(DB.medicosKey); medicos=medicos.filter(x=>x.id!==id); DB.save(DB.medicosKey,medicos); renderMedicos(); populateSelects(); updateCounters(); }
function resetMedicoForm(){ editMedicoId=null; formMedico.reset(); }

// --- Ingresos ---
const formIngreso=document.getElementById('form-ingreso'); let editIngresoId=null;
formIngreso.addEventListener('submit', e=>{ e.preventDefault(); const f=new FormData(formIngreso);
  const pacienteId=f.get('pacienteId'); const medicoId=f.get('medicoId'); const fechaIngreso=f.get('fechaIngreso'); const fechaAlta=f.get('fechaAlta');
  if(!pacienteId || !medicoId){ alert('Seleccione paciente y médico'); return }
  if(!fechaIngreso || !fechaAlta){ alert('Complete fechas de ingreso y de alta'); return }
  if(new Date(fechaAlta) < new Date(fechaIngreso)){ alert('La fecha de alta debe ser posterior o igual a la de ingreso'); return }

  // Rule: all ingresos of a paciente must belong to the same médico
  const ingresos=DB.load(DB.ingresosKey);
  const pacienteIngresos = ingresos.filter(i=>i.pacienteId===pacienteId);
  if(pacienteIngresos.length>0){ const medicoExist = pacienteIngresos[0].medicoId; if(medicoExist !== medicoId){ alert('Error: todos los ingresos de este paciente deben pertenecer al mismo médico ('+medicoExist+').'); return }}

  const ingreso = editIngresoId? Object.assign({id:editIngresoId}, { pacienteId, medicoId, fechaIngreso, fechaAlta, habitacion:f.get('habitacion'), cama:f.get('cama'), codigo: ingresos.find(i=>i.id===editIngresoId).codigo }) : { id: uid('ing'), pacienteId, medicoId, fechaIngreso, fechaAlta, habitacion:f.get('habitacion'), cama:f.get('cama'), codigo: genCodigoIngreso() }

  let all = DB.load(DB.ingresosKey);
  if(editIngresoId){ const idx=all.findIndex(x=>x.id===editIngresoId); all[idx]=ingreso; editIngresoId=null; } else all.push(ingreso);
  DB.save(DB.ingresosKey, all); formIngreso.reset(); renderIngresos(); populateSelects(); updateCounters(); alert('Ingreso guardado con código: '+ingreso.codigo);
})

function renderIngresos(){ const tbody=document.querySelector('#table-ingresos tbody'); tbody.innerHTML=''; const ingresos=DB.load(DB.ingresosKey); const pacientes=DB.load(DB.pacientesKey); const medicos=DB.load(DB.medicosKey);
  ingresos.forEach(i=>{ const paciente = pacientes.find(p=>p.id===i.pacienteId) || {nombre:'(eliminado)'}; const medico = medicos.find(m=>m.id===i.medicoId) || {nombre:'(eliminado)'}; const tr=document.createElement('tr'); tr.innerHTML=`<td>${i.codigo}</td><td>${paciente.nombre? paciente.nombre+' '+(paciente.apellido||''):'(sin paciente)'}</td><td>${medico.nombre? medico.nombre+' '+(medico.apellido||''):'(sin médico)'}</td><td>${i.habitacion||''}/${i.cama||''}</td><td>${i.fechaIngreso}</td><td>${i.fechaAlta}</td><td class="row-actions"><button onclick="editIngreso('${i.id}')">Editar</button><button onclick="eliminarIngreso('${i.id}')">Eliminar</button></td>`; tbody.appendChild(tr); }) }

function editIngreso(id){ const all=DB.load(DB.ingresosKey); const i=all.find(x=>x.id===id); if(!i) return; editIngresoId=id; document.getElementById('select-pacientes-for-ingreso').value=i.pacienteId; document.getElementById('select-medicos-for-ingreso').value=i.medicoId; formIngreso.fechaIngreso.value=i.fechaIngreso; formIngreso.fechaAlta.value=i.fechaAlta; formIngreso.habitacion.value=i.habitacion; formIngreso.cama.value=i.cama; showSection('ingresos'); }
function eliminarIngreso(id){ if(!confirm('Eliminar ingreso?')) return; let all=DB.load(DB.ingresosKey); const ingreso = all.find(x=>x.id===id); all=all.filter(x=>x.id!==id); DB.save(DB.ingresosKey,all);
  // Also delete related citas that require this ingreso? We will keep citas but they must still obey rule. Simpler: delete citas of this paciente if scheduled before any other alta? For simplicity, we will not auto-delete citas.
  renderIngresos(); renderCitas(); updateCounters(); }
function resetIngresoForm(){ editIngresoId=null; formIngreso.reset(); }

// --- Citas ---
const formCita=document.getElementById('form-cita'); let editCitaId=null;
formCita.addEventListener('submit', e=>{ e.preventDefault(); const f=new FormData(formCita); const pacienteId=f.get('pacienteId'); const medicoId=f.get('medicoId'); const fechaCita=f.get('fechaCita'); const descripcion=f.get('descripcion');
  if(!pacienteId||!medicoId||!fechaCita){ alert('Complete todos los campos'); return }
  // Rule: need to find the last alta date (estancia) for the paciente and ensure fechaCita is after alta
  const ingresos = DB.load(DB.ingresosKey).filter(i=>i.pacienteId===pacienteId);
  if(ingresos.length===0){ alert('Este paciente no tiene ingresos registrados. No se puede agendar la cita de seguimiento.'); return }
  // take the most recent alta
  const ultimaAlta = ingresos.map(i=>new Date(i.fechaAlta)).sort((a,b)=>b-a)[0];
  if(new Date(fechaCita) <= ultimaAlta){ alert('La cita debe programarse posterior a la fecha de alta del paciente ('+ultimaAlta.toISOString().slice(0,10)+').'); return }
  // also ensure that the medico selected is the same that attended patient's ingresos
  const medicoAsignado = ingresos[0].medicoId; if(medicoAsignado !== medicoId){ if(!confirm('Advertencia: el médico seleccionado no es el médico que atendió al paciente en sus ingresos. Desea continuar?')) return }
  const cita = editCitaId? Object.assign({id:editCitaId}, { pacienteId, medicoId, fechaCita, descripcion }) : { id: uid('cita'), pacienteId, medicoId, fechaCita, descripcion }
  let all = DB.load(DB.citasKey); if(editCitaId){ const idx=all.findIndex(x=>x.id===editCitaId); all[idx]=cita; editCitaId=null; } else all.push(cita);
  DB.save(DB.citasKey, all); formCita.reset(); renderCitas(); updateCounters(); alert('Cita agendada.'); })

function renderCitas(){ const tbody=document.querySelector('#table-citas tbody'); tbody.innerHTML=''; const citas=DB.load(DB.citasKey); const pacientes=DB.load(DB.pacientesKey); const medicos=DB.load(DB.medicosKey);
  citas.forEach(c=>{ const p=pacientes.find(x=>x.id===c.pacienteId)||{nombre:'(sin paciente)'}; const m=medicos.find(x=>x.id===c.medicoId)||{nombre:'(sin medico)'}; const tr=document.createElement('tr'); tr.innerHTML=`<td>${p.nombre? p.nombre+' '+(p.apellido||''):'(sin paciente)'}</td><td>${m.nombre? m.nombre+' '+(m.apellido||''):'(sin medico)'}</td><td>${c.fechaCita.replace('T',' ')}</td><td>${c.descripcion||''}</td><td class="row-actions"><button onclick="editCita('${c.id}')">Editar</button><button onclick="eliminarCita('${c.id}')">Eliminar</button></td>`; tbody.appendChild(tr); }) }

function editCita(id){ const all=DB.load(DB.citasKey); const c=all.find(x=>x.id===id); if(!c) return; editCitaId=id; document.getElementById('select-pacientes-for-cita').value=c.pacienteId; document.getElementById('select-medicos-for-cita').value=c.medicoId; formCita.fechaCita.value=c.fechaCita; formCita.descripcion.value=c.descripcion; showSection('citas'); }
function eliminarCita(id){ if(!confirm('Eliminar cita?')) return; let all=DB.load(DB.citasKey); all=all.filter(x=>x.id!==id); DB.save(DB.citasKey,all); renderCitas(); updateCounters(); }
function resetCitaForm(){ editCitaId=null; formCita.reset(); }

// --- Selects and counters ---
function populateSelects(){ const pacientes=DB.load(DB.pacientesKey); const medicos=DB.load(DB.medicosKey);
  const sel1=document.getElementById('select-pacientes-for-ingreso'); const sel2=document.getElementById('select-pacientes-for-cita'); const sm1=document.getElementById('select-medicos-for-ingreso'); const sm2=document.getElementById('select-medicos-for-cita'); [sel1,sel2].forEach(s=>{ if(!s) return; s.innerHTML=''; const opt=document.createElement('option'); opt.value=''; opt.textContent='-- Seleccione --'; s.appendChild(opt); pacientes.forEach(p=>{ const o=document.createElement('option'); o.value=p.id; o.textContent=p.nombre+' '+(p.apellido||''); s.appendChild(o); }) }); [sm1,sm2].forEach(s=>{ if(!s) return; s.innerHTML=''; const opt=document.createElement('option'); opt.value=''; opt.textContent='-- Seleccione --'; s.appendChild(opt); medicos.forEach(m=>{ const o=document.createElement('option'); o.value=m.id; o.textContent=m.nombre+' '+(m.apellido||'')+' ('+(m.especialidad||'')+')'; s.appendChild(o); }) }); }

function updateCounters(){ document.getElementById('count-pacientes').textContent = DB.load(DB.pacientesKey).length; document.getElementById('count-medicos').textContent = DB.load(DB.medicosKey).length; document.getElementById('count-ingresos').textContent = DB.load(DB.ingresosKey).length; }

// --- Inicialización ---
populateSelects(); renderPacientes(); renderMedicos(); renderIngresos(); renderCitas(); updateCounters();

// Optional: helper to seed demo data for first use
function seedDemo(){ if(confirm('Crear datos de demo?')){
  const p1={id:uid('pac'),nombre:'María',apellido:'Lopez',direccion:'Calle 1',telefono:'555-1234',cp:'01234',fechaNacimiento:'1985-06-12'};
  const p2={id:uid('pac'),nombre:'Juan',apellido:'Perez',direccion:'Av Central',telefono:'555-5678',cp:'06700',fechaNacimiento:'1990-11-02'};
  const m1={id:uid('med'),nombre:'Dr. Luis',apellido:'Gomez',direccion:'Clínica 1',telefono:'555-9000',especialidad:'Cardiología',cp:'01000'};
  DB.save(DB.pacientesKey,[p1,p2]); DB.save(DB.medicosKey,[m1]);
  const ing1={id:uid('ing'), pacienteId:p1.id, medicoId:m1.id, fechaIngreso:'2025-07-01', fechaAlta:'2025-07-07', habitacion:'201', cama:'A', codigo: genCodigoIngreso() };
  DB.save(DB.ingresosKey,[ing1]); DB.save(DB.citasKey,[]);
  populateSelects(); renderPacientes(); renderMedicos(); renderIngresos(); renderCitas(); updateCounters();
 }
}

</script>

</body>
</html>